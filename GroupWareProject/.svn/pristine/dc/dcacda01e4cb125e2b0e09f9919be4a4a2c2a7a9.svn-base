<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>

<div class="card">
    <div>
        <div class="row gx-0">
            <div class="col-lg-12">
                <div class="p-4 calender-sidebar app-calendar">
                    <div id="calendar"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 일정 등록창 Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">회의실 예약 등록</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="roomName" class="form-label">회의실명</label>
                    <input type="text" class="form-control" id="roomName">
                </div>
                <div class="mb-3">
                    <label for="seats" class="form-label">회의실 좌석수</label>
                    <input type="number" class="form-control" id="seats">
                </div>
                <div class="mb-3">
                    <label for="reservationDateTime" class="form-label">시작시간</label>
                    <input type="datetime-local" class="form-control" id="start">
                </div>
                <div class="mb-3">
                    <label for="reservationDateTime" class="form-label">종료시간</label>
                    <input type="datetime-local" class="form-control" id="end">
                </div>
                <div class="mb-3">
                    <label for="reserver" class="form-label">예약자</label>
                    <input type="text" class="form-control" id="reserver">
                </div>
                <div class="mb-3">
                    <label for="reservationContents" class="form-label">예약내용</label>
                    <textarea class="form-control" id="contents" rows="3"></textarea>
                </div>
                <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" value="" id="beamProjector">
                    <label class="form-check-label" for="beamProjector">
                       		 빔프로젝터 사용 가능 여부
                    </label>
                </div>
                <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" value="" id="whiteBoard">
                    <label class="form-check-label" for="whiteBoard">
                       		 화이트 보드 사용 가능 여부
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                <button type="button" class="btn btn-primary" id="saveReservation">등록</button>
            </div>
        </div>
    </div>
</div>




<%-- <script src="${pageContext.request.contextPath }/resources/project/js/datetimepicker/bootstrap-material-datetimepicker.js"></script> --%>
<script src="${pageContext.request.contextPath }/resources/project/js/sweetalert_custom.js"></script>
<script src="${pageContext.request.contextPath }/resources/project/js/source/index.global.min.js"></script>


<!-- jqeruy 로드 후 datepicker를 로드-->
<script src="https://code.jquery.com/jquery-3.2.1.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"/></script>
<!--한글-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/locales/bootstrap-datepicker.ko.min.js"/></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay'
            },
            initialView: 'timeGridWeek',
            slotMinTime: '09:00:00',
            slotMaxTime: '22:00:00',
            selectable: true,
            select: function(arg) {
                // 현재 시각 가져오기
			   var now = new Date();
			   // 선택한 시작 시간 가져오기
			   var start = arg.start;
			   // 현재 시각과 선택한 시작 시간을 비교하여 이전인 경우 알림 표시
			   if (start < now) {
			       alert("현재 시각 이후의 일정만 선택할 수 있습니다.");
			       return;
			   }
                var start = arg.start;
                var end = arg.end;
              // 시작 시간과 종료 시간을 모달 창에 설정
              document.getElementById('start').value = start.toISOString().slice(0, 16);
              document.getElementById('end').value = end.toISOString().slice(0, 16);
              
              var loggedInUser = "SUN";
              document.getElementById('reserver').value = loggedInUser;
                
            // 모달 창 열기
	        $('#exampleModal').modal('show');
	            }
	        });
	        calendar.render();
    });

    document.getElementById('saveChanges').addEventListener('click', function() {
        // 저장 버튼 클릭 시 실행되는 코드
        var roomName = document.getElementById('roomName').value;
        var seats = document.getElementById('seats').value;
        var start = document.getElementById('start').value;
        var end = document.getElementById('end').value;
        var reserver = document.getElementById('reserver').value;
        var reservationContents = document.getElementById('contents').value;
        var beamProjector = document.getElementById('beamProjector').checked;
        var whiteBoard = document.getElementById('whiteBoard').checked;
        
        // 예약 정보 출력 또는 다른 작업 수행
        console.log("회의실명:", roomName);
        console.log("좌석수:", seats);
        console.log("시작시간:", start);
        console.log("종료시간:", end);
        console.log("예약자:", reserver);
        console.log("예약내용:", contents);
        console.log("빔프로젝터 사용 가능 여부:", beamProjector);
        console.log("화이트 보드 사용 가능 여부:", whiteBoard);
        
        
        // 여기에 예약 정보를 서버로 전송하는 등의 작업할것
        
        
        
        
        
        // 입력된 일정 정보를 이용하여 FullCalendar에 이벤트 추가
        var eventData = {
        	roomName: roomName,
        	seats: seats,
            start: start,
            end: end,
            reserver: reserver,
            contents: contents,
            beamProjector: beamProjector,
            whiteBoard: whiteBoard
            
        };
        calendar.addEvent(eventData);

        // 모달 창 닫기
        $('#exampleModal').modal('hide');

        // 입력 폼 초기화
        document.getElementById('roomName').value = '';
        document.getElementById('seats').value = '';
        document.getElementById('start').value = '';
        document.getElementById('end').value = '';
        document.getElementById('reserver').value = '';
        document.getElementById('contents').value = '';
        document.getElementById('beamProjector').value = '';
        document.getElementById('whiteBoard').value = '';
        
    });
</script>
