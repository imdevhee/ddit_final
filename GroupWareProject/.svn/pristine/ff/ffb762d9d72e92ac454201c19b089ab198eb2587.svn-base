<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt"%>
<c:if test="${not empty message }">
	<script>
		showToast("${message}", 'info');
		<c:remove var="message" scope="request"/>
	</script>
</c:if>
<div class="card bg-info-subtle shadow-none position-relative overflow-hidden mb-4">
	<div class="card-body px-4 py-3">
		<div class="row align-items-center">
			<div class="col-9">
				<h4 class="fw-semibold mb-8">메일</h4>
				<nav aria-label="breadcrumb">
					<ol class="breadcrumb">
						<li class="breadcrumb-item"><a class="text-muted text-decoration-none" href="/">홈</a></li>
						<li class="breadcrumb-item" aria-current="page">메일</li>
					</ol>
				</nav>
			</div>
			<div class="col-3">
				<div class="text-center mb-n5">
					<img src="${pageContext.request.contextPath}/resources/vendor/images/breadcrumb/ChatBc.png" alt="" class="img-fluid mb-n4" />
				</div>
			</div>
		</div>
	</div>
</div>

<div class="card overflow-hidden chat-application">
	<div class="d-flex align-items-center justify-content-between gap-6 m-3 d-lg-none">
		<button class="btn btn-primary d-flex" type="button" data-bs-toggle="offcanvas" data-bs-target="#chat-sidebar" aria-controls="chat-sidebar">
			<i class="ti ti-menu-2 fs-5"></i>
		</button>
		<form class="position-relative w-100">
			<input type="text" class="form-control search-chat py-2 ps-5" id="text-srh" placeholder="Search Contact">
			<i class="ti ti-search position-absolute top-50 start-0 translate-middle-y fs-6 text-dark ms-3"></i>
		</form>
	</div>
	<div class="d-flex w-100">
		<div class="left-part border-end w-20 flex-shrink-0 d-none d-lg-block h-auto">
			<div class="px-9 pt-4 pb-3">
				<button class="btn btn-primary fw-semibold py-8 w-100">메일 쓰기</button>
			</div>
			<ul class="list-group mh-n100" data-simplebar>
				<li class="border-bottom my-3"></li>
				<li class="list-group-item border-0 p-0 mx-9"><a class="d-flex align-items-center gap-6 list-group-item-action text-dark px-3 py-8 mb-1 rounded-1" href="/mail/inbox">
						<i class="ti ti-inbox fs-5"></i>받은메일함
					</a></li>
				<li class="list-group-item border-0 p-0 mx-9"><a class="d-flex align-items-center gap-6 list-group-item-action text-dark px-3 py-8 mb-1 rounded-1" href="javascript:void(0)">
						<i class="ti ti-brand-telegram fs-5"></i>보낸메일함
					</a></li>
				<li class="list-group-item border-0 p-0 mx-9"><a class="d-flex align-items-center gap-6 list-group-item-action text-dark px-3 py-8 mb-1 rounded-1" href="javascript:void(0)">
						<i class="ti ti-inbox fs-5"></i>안읽은메일함
					</a></li>
				<li class="list-group-item border-0 p-0 mx-9"><a class="d-flex align-items-center gap-6 list-group-item-action text-dark px-3 py-8 mb-1 rounded-1" href="javascript:void(0)">
						<i class="ti ti-file-text fs-5"></i>임시보관함
					</a></li>
				<li class="list-group-item border-0 p-0 mx-9"><a class="d-flex align-items-center gap-6 list-group-item-action text-dark px-3 py-8 mb-1 rounded-1" href="javascript:void(0)">
						<i class="ti ti-inbox fs-5"></i>내게쓴메일함
					</a></li>
				<li class="border-bottom my-3"></li>
				<li class="fw-semibold text-dark text-uppercase mx-9 my-2 px-3 fs-2">IMPORTANT</li>
				<li class="list-group-item border-0 p-0 mx-9"><a class="d-flex align-items-center gap-6 list-group-item-action text-dark px-3 py-8 mb-1 rounded-1" href="javascript:void(0)">
						<i class="ti ti-star fs-5"></i>중요메일함
					</a></li>
				<li class="list-group-item border-0 p-0 mx-9"><a class="d-flex align-items-center gap-6 list-group-item-action text-dark px-3 py-8 mb-1 rounded-1" href="javascript:void(0)" class="d-block ">
						<i class="ti ti-badge fs-5"></i>예약메일함
					</a></li>
				<li class="border-bottom my-3"></li>
				<li class="list-group-item border-0 p-0 mx-9"><a class="d-flex align-items-center gap-6 list-group-item-action text-dark px-3 py-8 mb-1 rounded-1" href="javascript:void(0)">
						<i class="ti ti-trash fs-5"></i>휴지통
					</a></li>
			</ul>
		</div>
		<!-- 메뉴 옆 오른쪽 구역 시작 -->
		<div class="w-100">
			<div class="min-width-340">
				<div class="border-end user-chat-box h-100">
					<div class="px-4 pt-9 pb-6 d-none d-lg-block">
						<form id="searchForm">
							<input type="hidden" name="page" id="page" />
							<div class="d-flex align-items-center">
								<div class="col-6">
									<div>
										<span class="fs-5 fw-bold"><i class="ti ti-inbox fs-5"></i> 받은메일함</span> <span>&nbsp;&nbsp;전체메일 ${pagingVO.totalRecord } / 안읽은메일 ${noRead }</span>
									</div>
								</div>
								<div class="col-6">
									<div class="input-group">
										<input type="text" class="form-control form-select-sm" id="selectedMail" value="메일" readonly style="text-align: center; caret-color: transparent;">
										<input type="text" class="form-control" id="searchWord" name="searchWord" value="${searchWord }" placeholder="부서, 직급, 이름, 제목" />
										<button type="button" class="btn bg-primary-subtle text-primary">상세</button>
										<button type="submit" class="btn bg-primary-subtle text-primary">검색</button>
									</div>
								</div>
							</div>
						</form>
					</div>

					<nav class="navbar navbar-expand-sm">
						<div class="container-fluid">
							<div class="collapse navbar-collapse justify-content-between" id="collapsibleNavbar">
								<ul class="navbar-nav">
									<li class="nav-item"><input type="checkbox" class="form-check-input" name="selectAll" id="selectAll"> <label for="selectAll">전체선택</label></li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
									<li class="nav-item"><span id="trash"><label for="trash" style="cursor: pointer;"><i class="ti ti-trash fs-5"></i>삭제</span></label></li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
									<li class="nav-item"><span id="important"><label for="important" style="cursor: pointer;"><i class="ti ti-star fs-5"></i>중요</span></label></li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
									<li class="nav-item"><span id="read"><label for="read" style="cursor: pointer;"><i class="ti ti-inbox fs-5"></i>읽음처리</span></label></li>
								</ul>
								<ul class="navbar-nav">
									<li class="nav-item mt-1"><span id="send"><i class="ti ti-star fs-4 me-1 text-dark"></i></span> <label for="send">정렬콘</label></li>
									<li class="nav-item"><select class="form-select form-select-sm">
											<option value="20">20</option>
											<option value="20">40</option>
											<option value="20">60</option>
										</select></li>
								</ul>
							</div>
						</div>
					</nav>

					<div class="app-chat">
						<ul class="chat-users mh-n100" data-simplebar>
							<!-- 메일 목록 시작 -->
							<c:set value="${pagingVO.dataList }" var="emailList" />
							<c:choose>
								<c:when test="${empty emailList }">
									<li><a href="javascript:void(0)" class="px-4 py-3 bg-hover-light-black d-flex align-items-start justify-content-between chat-user" id="chat_user_3" data-user-id="3">
											<div class="form-check mb-0">
												<input class="form-check-input" type="checkbox" value="" id="select" name="select">
											</div>
											<div class="position-relative w-100 ms-2">
												<div class="d-flex align-items-center justify-content-between mb-2">
													<h6 class="mb-0"></h6>
												</div>
												<h6 class="text-dark">해당 메일함에 메일이 존재하지 않습니다.</h6>
												<div class="d-flex align-items-center justify-content-between">
													<div class="d-flex align-items-center">
														<span><i class="ti ti-star fs-4 me-2 text-muted"></i></span> <span class="d-block"><i class="ti ti-alert-circle text-warning"></i></span>
													</div>
												</div>
											</div>
										</a></li>
								</c:when>
								<c:otherwise>
									<c:forEach items="${emailList }" var="email">
										<li><a href="javascript:void(0)" class="px-4 py-3 bg-hover-light-black d-flex align-items-start justify-content-between chat-user" id="chat_user_3" data-user-id="3">
												<div class="form-check mb-0">
													<input class="form-check-input" type="checkbox" value="${email.emailNo }" id="select" name="select">
												</div>
												<div class="position-relative w-100 ms-2">
													<div class="d-flex align-items-center justify-content-between mb-2">
														<h6 class="mb-0">${email.employeeVO.deptCode }${email.employeeVO.emplNm }${email.employeeVO.classOfPositionVO.clsfNm }</h6>
													</div>
													<c:if test="${email.emailReceptionVO.emailRecptnReadYn eq 'N'}">
														<h6 class="text-dark" style="font-weight: bold;" onclick="location.href='/mail/detail?emailNo=${email.emailNo}'">${email.emailNm}</h6>
													</c:if>
													<c:if test="${email.emailReceptionVO.emailRecptnReadYn eq 'Y'}">
														<h6 class="text-dark" onclick="location.href='/mail/detail?emailNo=${email.emailNo}'">${email.emailNm }</h6>
													</c:if>
													<div class="d-flex align-items-center justify-content-between">
														<div class="d-flex align-items-center">
															<span><i class="ti ti-star fs-4 me-2 text-muted"></i></span> <span class="d-block"><i class="ti ti-alert-circle text-warning"></i></span>
														</div>
														<p class="mb-0 fs-2 text-muted">
															<fmt:formatDate value="${email.emailRgdde }" pattern="yyyy.MM.dd a hh:mm:ss" />
														</p>
													</div>
												</div>
											</a></li>
									</c:forEach>
								</c:otherwise>
							</c:choose>
							<!-- 메일 목록 끝 -->
						</ul>
						<nav aria-label="Page navigation example" id="pagingArea">${pagingVO.pagingHTML }</nav>
					</div>
				</div>
			</div>
		</div>
		<!-- 메뉴 옆 오른쪽 구역 끝 -->
	</div>
</div>



<script src="${pageContext.request.contextPath}/resources/vendor/js/apps/chat.js"></script>
<script>

var trash = $("#trash"); // 휴지통
var important = $("#important"); // 중요
var read = $("#read"); // 읽음처리
var select = $('input[name="select"]'); // 메일 체크박스

// 체크된 항목의 값을 저장할 배열 생성
var selectedValues = [];
var checkflag = false;

select.on("change", function() {

	var data = $(this).val();
    console.log(data);
	checkflag = true;
    // select 요소에서 선택된 옵션들을 반복하여 확인
    if(checkflag) {
		selectedValues.push($(this).val());
    }else {
    	var index = selectedValues.indexOf($(this).val());
    	if (index !== -1) {
    	    selectedValues.splice(index, 1);
    	}
    }
});    
    
trash.on("click", function() { 
	console.log("클릭함" + selectedValues);
}); 

// trash.on("click", function() {
	
// 	    // Ajax 요청을 보내기 위한 데이터 객체 생성
// 	    var data = {
// 	        selectedValues: selectedValues
// 	    };
	    
// 	    console.log(data);
	    
	    // Ajax 요청 보내기
// 	    $.ajax({
// 	        url: "your_endpoint_url_here",
// 	        method: "POST", // 또는 "GET"에 따라 Ajax 요청 방식 선택
// 	        data: requestData,
// 	        success: function(response) {
// 	            // 성공적으로 서버에서 응답을 받았을 때 실행되는 코드
// 	            console.log("Ajax 요청 성공: ", response);
// 	        },
// 	        error: function(xhr, status, error) {
// 	            // Ajax 요청이 실패했을 때 실행되는 코드
// 	            console.error("Ajax 요청 실패: ", status, error);
// 	        }
// 	    });
// 	});
// });

important.on("click", function() {
});

read.on("click", function() {
});



$(function(){
	var searchForm = $("#searchForm");
	var pagingArea = $("#pagingArea");
	
	pagingArea.on("click","a",function(event){
		event.preventDefault();
		var pageNo = $(this).data("page");
		searchForm.find("#page").val(pageNo);
		searchForm.submit();
	});
});

// 체크박스 전체 선택
selectAll.addEventListener('change', function() {
	let select = document.getElementsByName('select');
	for(let i in select) {
		select[i].checked = selectAll.checked;
	}
});

// 체크박스 전체 선택
function isSelectAll() {
	let select = document.getElementsByName('select');
	
	select.forEach(selected => {
		selected.addEventListener('click', function(e) {
			var allChecked = true;
			
			select.forEach(function(checkbox) {
	            if (!checkbox.checked) {
	                allChecked = false;
	            }
	        });
			
	        selectAll.checked = allChecked;
		});
	});
}



</script>