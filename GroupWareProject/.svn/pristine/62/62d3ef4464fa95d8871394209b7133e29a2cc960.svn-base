<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt"%>
<%@ taglib uri="http://www.springframework.org/security/tags" prefix="sec"%>

<style>
.accordion-button {
	display: flex;
	justify-content: space-between;
	align-items: center;
}

.accordion-button span {
	flex: 1;
	text-align: center;
}

thead tr:first-child td {
	border-bottom: 1px solid #dee2e6;
}

.accordion-button:focus {
	box-shadow: none !important; /* 기존 속성 덮어쓰기 */
}

td {
	text-align: left;
}
/* tr#th td { */
/*     text-align: center; */
/* } */
.btn.btn-sm.btn-outline-primary:hover {
	background-color: initial !important; /* 마우스 오버 시 색깔이 변하지 않도록 */
	color: #007bff !important;
}
</style>

<script>
	var current = new Date();
	var currentYear = current.getFullYear(); // 연도
	var currentMonth = current.getMonth() + 1; // 월 (0부터 시작하므로 1을 더해줌)
	var currentDay = current.getDate(); // 일자
</script>

<!-- 메뉴 옆 오른쪽 구역 시작 -->
<div class="w-100">
	<div class="min-width-340">
		<h4 class="fw-semibold mb-8" style="margin-left: 0px">근태현황</h4>
		<br />
		<!-- < 2024. 04 > -->
		<div class="position-relative text-center" style="margin-bottom: 30px">
			<h4>
				<a class="text-dark px-2 fs-5 bg-hover-primary nav-icon-hover position-relative" style="cursor: pointer;" onclick="previous()"> <i class="fa-solid fa-chevron-left fa-xs"></i>
				</a> <span class="fw-semibold mb-8" id="baseDate" style="margin: 15px">&nbsp;${year}.${month}</span> <a class="text-dark px-2 fs-5 bg-hover-primary nav-icon-hover position-relative" style="cursor: pointer;" onclick="next()"> <i class="fa-solid fa-chevron-right fa-xs"></i>
				</a>
			</h4>
			<button type="button" id="todayBtn" class="btn btn-sm btn-outline-primary">오늘</button>
		</div>
		<!-- < 2024.04 > -->

		<!-- 목록 다운로드 -->
		<div class="d-flex align-items-center">
			<div class="col-10"></div>
			<dib class="col-2">
			<button type="button" class="justify-content-center w-100 btn mb-1 bg-primary-subtle text-primary  d-flex align-items-center" style="margin-right: 20px">
				<i class="fa-duotone fa-arrow-down-to-line"></i>&nbsp;&nbsp;목록 다운로드
			</button>
		</div>
		<!-- 목록 다운로드 -->

		<!-- 이번주 현황 테이블 -->
		<table style="width: 100%; border-collapse: collapse; border: 1px solid #ddd; margin-top: 15px; margin-bottom: 40px;">
			<tr>
				<td style="padding: 4px; padding-top: 30px; text-align: center; color: black;">이번주 누적</td>
				<td style="padding: 4px; padding-top: 30px; text-align: center; color: black;">이번주 초과</td>
				<td style="padding: 4px; padding-top: 30px; text-align: center; color: black;">이번주 야간</td>
				<td style="padding: 4px; padding-top: 30px; text-align: center; color: grey;">이번달 누적</td>
				<td style="padding: 4px; padding-top: 30px; text-align: center; color: grey;">이번달 연장</td>
			</tr>
			<tr>
				<td style="padding: 4px; padding-bottom: 30px; text-align: center; font-size: 23px; color: #739ee8;">${thisWeekDefault }</td>
				<td style="padding: 4px; padding-bottom: 30px; text-align: center; font-size: 23px; color: #739ee8;">${thisWeekOver }</td>
				<td style="padding: 4px; padding-bottom: 30px; text-align: center; font-size: 23px; color: #739ee8;">${thisNightOver }</td>
				<td style="padding: 4px; padding-bottom: 30px; text-align: center; font-size: 23px; color: grey;">${thisMonthDefault }</td>
				<td style="padding: 4px; padding-bottom: 30px; text-align: center; font-size: 23px; color: grey;">${thisMonthOver }</td>
			</tr>
		</table>
		<!-- 이번주 현황 테이블 -->

		<!-- 1주차 ~ 5주차 -->
		<div class="accordion accordion-flush" id="accordionFlushExample" style="margin-bottom: 30px;">
			<div class="accordion-item">
				<h2 class="accordion-header" id="flush-heading1">
					<button class="accordion-button collapsed" type="button" id="accordionBtn1" data-bs-toggle="collapse" data-bs-target="#flush-collapse1" aria-expanded="false" aria-controls="flush-collapse1">
						<span style="float: left; font-size: 16px;"><b>1 주차</b></span> <span style="float: right; color: grey;"><b>누적 근무시간 ${weekDefaultList.get(0) }</b> (초과 근무시간 ${weekOverList.get(0) })</span>
					</button>
				</h2>
				<div id="flush-collapse1" class="accordion-collapse collapse" aria-labelledby="flush-heading1">
					<div class="accordion-body">
						<table class="table table-borderless table-hover text-center align-middle">
							<thead>
								<tr id="th">
									<td>일자</td>
									<td>업무시작</td>
									<td>업무종료</td>
									<td>총 근무시간</td>
									<td>근무시간 상세</td>
								</tr>
							</thead>
							<tbody>
								<c:forEach items="${allDataList}" var="dclzStatus" begin="0" end="6" varStatus="stat">
									<tr>
<%-- 										<c:choose> --%>
<%-- 											<c:when test="${dclzStatus.date.year gt currentYear && dclzStatus.date.month gt currentMonth && dclzStatus.date.day gt currentDay)}"> --%>
<!-- 												<td style="color: #739ee8;"> -->
<%-- 											</c:when> --%>
<%-- 											<c:otherwise> --%>
												<c:choose>
													<c:when test="${stat.index == 5}">
														<td style="color: grey;">
													</c:when>
													<c:when test="${stat.index == 6}">
														<td style="color: #ff3838;">
													</c:when>
													<c:otherwise>
														<td>
													</c:otherwise>
												</c:choose>
<%-- 											</c:otherwise> --%>
<%-- 										</c:choose> --%>
										<fmt:formatDate value="${dclzStatus.date}" pattern="dd E" />
										</td>
										<c:choose>
											<c:when test="${empty dclzStatus.attendDt }">
												<td colspan="4">결근, 휴가, 이유 같은 거?</td>
											</c:when>
											<c:otherwise>
												<c:choose>
													<c:when test="${dclzStatus.attendDt.hours gt 9 || (dclzStatus.attendDt.hours eq 9 && dclzStatus.attendDt.minutes gt 0) || (dclzStatus.attendDt.hours eq 9 && dclzStatus.attendDt.minutes eq 0 && dclzStatus.attendDt.seconds gt 0)}">
														<td style="color: #ff3838;">
													</c:when>
													<c:otherwise>
														<td>
													</c:otherwise>
												</c:choose>
												<fmt:formatDate value="${dclzStatus.attendDt}" pattern="HH:mm:ss" />
												</td>
												<td><fmt:formatDate value="${dclzStatus.lvffcDt}" pattern="HH:mm:ss" /></td>
												<td><b>${dclzStatus.defaultTime }</b></td>
												<td>기본 ${dclzStatus.defaultTime } / 연장 ${dclzStatus.overTime } / 야간 ${dclzStatus.nightTime }</td>
											</c:otherwise>
										</c:choose>
									</tr>
								</c:forEach>
							</tbody>
						</table>
					</div>
				</div>
			</div>
			<div class="accordion-item">
				<h2 class="accordion-header" id="flush-heading2">
					<button class="accordion-button collapsed" type="button" id="accordionBtn2" data-bs-toggle="collapse" data-bs-target="#flush-collapse2" aria-expanded="false" aria-controls="flush-collapse2">
						<span style="float: left; font-size: 16px;"><b>2 주차</b></span> <span style="float: right; color: grey;"><b>누적 근무시간 ${weekDefaultList.get(1) }</b> (초과 근무시간 ${weekOverList.get(1) })</span>
					</button>
				</h2>
				<div id="flush-collapse2" class="accordion-collapse collapse" aria-labelledby="flush-heading2">
					<div class="accordion-body">
						<table class="table table-borderless table-hover text-center align-middle">
							<thead>
								<tr>
									<td>일자</td>
									<td>업무시작</td>
									<td>업무종료</td>
									<td>총 근무시간</td>
									<td>근무시간 상세</td>
								</tr>
							</thead>
							<tbody>
								<c:forEach items="${allDataList}" var="dclzStatus" begin="7" end="13" varStatus="stat">
									<tr>
										<c:choose>
											<c:when test="${stat.index == 12}">
												<td style="color: grey;">
											</c:when>
											<c:when test="${stat.index == 13}">
												<td style="color: #ff3838;">
											</c:when>
											<c:otherwise>
												<td>
											</c:otherwise>
										</c:choose>
										<fmt:formatDate value="${dclzStatus.date}" pattern="dd E" />
										</td>
										<c:choose>
											<c:when test="${empty dclzStatus.attendDt }">
												<td colspan="4">결근, 휴가, 이유 같은 거?</td>
											</c:when>
											<c:otherwise>
												<c:choose>
													<c:when test="${dclzStatus.attendDt.hours gt 9 || (dclzStatus.attendDt.hours eq 9 && dclzStatus.attendDt.minutes gt 0) || (dclzStatus.attendDt.hours eq 9 && dclzStatus.attendDt.minutes eq 0 && dclzStatus.attendDt.seconds gt 0)}">
														<td style="color: #ff3838;">
													</c:when>
													<c:otherwise>
														<td>
													</c:otherwise>
												</c:choose>
												<fmt:formatDate value="${dclzStatus.attendDt}" pattern="HH:mm:ss" />
												</td>
												<td><fmt:formatDate value="${dclzStatus.lvffcDt}" pattern="HH:mm:ss" /></td>
												<td><b>${dclzStatus.defaultTime }</b></td>
												<td>기본 ${dclzStatus.defaultTime } / 연장 ${dclzStatus.overTime } / 야간 ${dclzStatus.nightTime }</td>
											</c:otherwise>
										</c:choose>
									</tr>
								</c:forEach>
							</tbody>
						</table>
					</div>
				</div>
			</div>
			<div class="accordion-item">
				<h2 class="accordion-header" id="flush-heading3">
					<button class="accordion-button collapsed" type="button" id="accordionBtn3" data-bs-toggle="collapse" data-bs-target="#flush-collapse3" aria-expanded="false" aria-controls="flush-collapse3">
						<span style="float: left; font-size: 16px;"><b>3 주차</b></span> <span style="float: right; color: grey;"><b>누적 근무시간 ${weekDefaultList.get(2) }</b> (초과 근무시간 ${weekOverList.get(2) })</span>
					</button>
				</h2>
				<div id="flush-collapse3" class="accordion-collapse collapse" aria-labelledby="flush-heading3">
					<div class="accordion-body">
						<table class="table table-borderless table-hover text-center align-middle">
							<thead>
								<tr>
									<td>일자</td>
									<td>업무시작</td>
									<td>업무종료</td>
									<td>총 근무시간</td>
									<td>근무시간 상세</td>
								</tr>
							</thead>
							<tbody>
								<c:forEach items="${allDataList}" var="dclzStatus" begin="14" end="20" varStatus="stat">
									<tr>
										<c:choose>
											<c:when test="${stat.index == 19}">
												<td style="color: grey;">
											</c:when>
											<c:when test="${stat.index == 20}">
												<td style="color: #ff3838;">
											</c:when>
											<c:otherwise>
												<td>
											</c:otherwise>
										</c:choose>
										<fmt:formatDate value="${dclzStatus.date}" pattern="dd E" />
										</td>
										<c:choose>
											<c:when test="${empty dclzStatus.attendDt }">
												<td colspan="4">결근, 휴가, 이유 같은 거?</td>
											</c:when>
											<c:otherwise>
												<c:choose>
													<c:when test="${dclzStatus.attendDt.hours gt 9 || (dclzStatus.attendDt.hours eq 9 && dclzStatus.attendDt.minutes gt 0) || (dclzStatus.attendDt.hours eq 9 && dclzStatus.attendDt.minutes eq 0 && dclzStatus.attendDt.seconds gt 0)}">
														<td style="color: #ff3838;">
													</c:when>
													<c:otherwise>
														<td>
													</c:otherwise>
												</c:choose>
												<fmt:formatDate value="${dclzStatus.attendDt}" pattern="HH:mm:ss" />
												</td>
												<td><fmt:formatDate value="${dclzStatus.lvffcDt}" pattern="HH:mm:ss" /></td>
												<td><b>${dclzStatus.defaultTime }</b></td>
												<td>기본 ${dclzStatus.defaultTime } / 연장 ${dclzStatus.overTime } / 야간 ${dclzStatus.nightTime }</td>
											</c:otherwise>
										</c:choose>
									</tr>
								</c:forEach>
							</tbody>
						</table>
					</div>
				</div>
			</div>
			<div class="accordion-item">
				<h2 class="accordion-header" id="flush-heading4">
					<button class="accordion-button collapsed" id="accordionBtn4" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapse4" aria-expanded="false" aria-controls="flush-collapse4">
						<span style="float: left; font-size: 16px;"><b>4 주차</b></span> <span style="float: right; color: grey;"><b>누적 근무시간 ${weekDefaultList.get(3) }</b> (초과 근무시간 ${weekOverList.get(3) })</span>
					</button>
				</h2>
				<div id="flush-collapse4" class="accordion-collapse collapse" aria-labelledby="flush-heading4">
					<div class="accordion-body">
						<table class="table table-borderless table-hover text-center align-middle">
							<thead>
								<tr>
									<td>일자</td>
									<td>업무시작</td>
									<td>업무종료</td>
									<td>총 근무시간</td>
									<td>근무시간 상세</td>
								</tr>
							</thead>
							<tbody>
								<c:forEach items="${allDataList}" var="dclzStatus" begin="21" end="27" varStatus="stat">
									<tr>
										<c:choose>
											<c:when test="${stat.index == 26}">
												<td style="color: grey;">
											</c:when>
											<c:when test="${stat.index == 27}">
												<td style="color: #ff3838;">
											</c:when>
											<c:otherwise>
												<td>
											</c:otherwise>
										</c:choose>
										<fmt:formatDate value="${dclzStatus.date}" pattern="dd E" />
										</td>
										<c:choose>
											<c:when test="${empty dclzStatus.attendDt }">
												<td colspan="4">결근, 휴가, 이유 같은 거?</td>
											</c:when>
											<c:otherwise>
												<c:choose>
													<c:when test="${dclzStatus.attendDt.hours gt 9 || (dclzStatus.attendDt.hours eq 9 && dclzStatus.attendDt.minutes gt 0) || (dclzStatus.attendDt.hours eq 9 && dclzStatus.attendDt.minutes eq 0 && dclzStatus.attendDt.seconds gt 0)}">
														<td style="color: #ff3838;">
													</c:when>
													<c:otherwise>
														<td>
													</c:otherwise>
												</c:choose>
												<fmt:formatDate value="${dclzStatus.attendDt}" pattern="HH:mm:ss" />
												</td>
												<td><fmt:formatDate value="${dclzStatus.lvffcDt}" pattern="HH:mm:ss" /></td>
												<td><b>${dclzStatus.defaultTime }</b></td>
												<td>기본 ${dclzStatus.defaultTime } / 연장 ${dclzStatus.overTime } / 야간 ${dclzStatus.nightTime }</td>
											</c:otherwise>
										</c:choose>
									</tr>
								</c:forEach>
							</tbody>
						</table>
					</div>
				</div>
			</div>
			<div class="accordion-item">
				<h2 class="accordion-header" id="flush-heading5">
					<button class="accordion-button collapsed" type="button" id="accordionBtn5" data-bs-toggle="collapse" data-bs-target="#flush-collapse5" aria-expanded="false" aria-controls="flush-collapse5">
						<span style="float: left; font-size: 16px;"><b>5 주차</b></span> <span style="float: right; color: grey;"><b>누적 근무시간 ${weekDefaultList.get(4) }</b> (초과 근무시간 ${weekOverList.get(4) })</span>
					</button>
				</h2>
				<div id="flush-collapse5" class="accordion-collapse collapse" aria-labelledby="flush-heading5">
					<div class="accordion-body">
						<table class="table table-borderless table-hover text-center align-middle">
							<thead>
								<tr>
									<td>일자</td>
									<td>업무시작</td>
									<td>업무종료</td>
									<td>총 근무시간</td>
									<td>근무시간 상세</td>
								</tr>
							</thead>
							<tbody>
								<c:forEach items="${allDataList}" var="dclzStatus" begin="28" end="34" varStatus="stat">
									<tr>
										<c:choose>
											<c:when test="${stat.index == 33}">
												<td style="color: grey;">
											</c:when>
											<c:when test="${stat.index == 34}">
												<td style="color: #ff3838;">
											</c:when>
											<c:otherwise>
												<td>
											</c:otherwise>
										</c:choose>
										<fmt:formatDate value="${dclzStatus.date}" pattern="dd E" />
										</td>
										<c:choose>
											<c:when test="${empty dclzStatus.attendDt }">
												<td colspan="4">결근, 휴가, 이유 같은 거?</td>
											</c:when>
											<c:otherwise>
												<c:choose>
													<c:when test="${dclzStatus.attendDt.hours gt 9 || (dclzStatus.attendDt.hours eq 9 && dclzStatus.attendDt.minutes gt 0) || (dclzStatus.attendDt.hours eq 9 && dclzStatus.attendDt.minutes eq 0 && dclzStatus.attendDt.seconds gt 0)}">
														<td style="color: #ff3838;">
													</c:when>
													<c:otherwise>
														<td>
													</c:otherwise>
												</c:choose>
												<fmt:formatDate value="${dclzStatus.attendDt}" pattern="HH:mm:ss" />
												</td>
												<td><fmt:formatDate value="${dclzStatus.lvffcDt}" pattern="HH:mm:ss" /></td>
												<td><b>${dclzStatus.defaultTime }</b></td>
												<td>기본 ${dclzStatus.defaultTime } / 연장 ${dclzStatus.overTime } / 야간 ${dclzStatus.nightTime }</td>
											</c:otherwise>
										</c:choose>
									</tr>
								</c:forEach>
							</tbody>
						</table>
					</div>
				</div>
			</div>
			<c:if test="${allDataList.size() > 35 }">
				<div class="accordion-item">
					<h2 class="accordion-header" id="flush-heading6">
						<button class="accordion-button collapsed" type="button" id="accordionBtn6" data-bs-toggle="collapse" data-bs-target="#flush-collapse6" aria-expanded="false" aria-controls="flush-collapse5">
							<span style="float: left; font-size: 16px;"><b>6 주차</b></span> <span style="float: right; color: grey;"><b>누적 근무시간 ${weekDefaultList.get(5) }</b> (초과 근무시간 ${weekOverList.get(5) })</span>
						</button>
					</h2>
					<div id="flush-collapse6" class="accordion-collapse collapse" aria-labelledby="flush-heading6">
						<div class="accordion-body">
							<table class="table table-borderless table-hover text-center align-middle">
								<thead>
									<tr>
										<td>일자</td>
										<td>업무시작</td>
										<td>업무종료</td>
										<td>총 근무시간</td>
										<td>근무시간 상세</td>
									</tr>
								</thead>
								<tbody>
									<c:forEach items="${allDataList}" var="dclzStatus" begin="35" end="41" varStatus="stat">
										<tr>
											<c:choose>
												<c:when test="${stat.index == 40}">
													<td style="color: grey;">
												</c:when>
												<c:when test="${stat.index == 41}">
													<td style="color: #ff3838;">
												</c:when>
												<c:otherwise>
													<td>
												</c:otherwise>
											</c:choose>
											<fmt:formatDate value="${dclzStatus.date}" pattern="dd E" />
											</td>
											<c:choose>
												<c:when test="${empty dclzStatus.attendDt }">
													<td colspan="4">결근, 휴가, 이유 같은 거?</td>
												</c:when>
												<c:otherwise>
													<c:choose>
														<c:when test="${dclzStatus.attendDt.hours gt 9 || (dclzStatus.attendDt.hours eq 9 && dclzStatus.attendDt.minutes gt 0) || (dclzStatus.attendDt.hours eq 9 && dclzStatus.attendDt.minutes eq 0 && dclzStatus.attendDt.seconds gt 0)}">
															<td style="color: #ff3838;">
														</c:when>
														<c:otherwise>
															<td>
														</c:otherwise>
													</c:choose>
													<fmt:formatDate value="${dclzStatus.attendDt}" pattern="HH:mm:ss" />
													</td>
													<td><fmt:formatDate value="${dclzStatus.lvffcDt}" pattern="HH:mm:ss" /></td>
													<td><b>${dclzStatus.defaultTime }</b></td>
													<td>기본 ${dclzStatus.defaultTime } / 연장 ${dclzStatus.overTime } / 야간 ${dclzStatus.nightTime }</td>
												</c:otherwise>
											</c:choose>
										</tr>
									</c:forEach>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</c:if>
		</div>
		<!-- 1주차~5주차 -->
		<!-- 정상, 지각 -->
		<div style="margin-bottom: 50px;">
			<i class="fa-solid fa-circle fa-sm" style="color: #413e3e;"> 정상</i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa-solid fa-circle fa-sm" style="color: #ff3838;"> 지각 </i>
		</div>
	</div>
</div>
<!-- 메뉴 옆 오른쪽 구역 끝 -->



<script src="${pageContext.request.contextPath}/resources/vendor/js/apps/chat.js"></script>
<c:if test="${not empty message }">
	<script>
		showToast("${message}", 'info');
		<c:remove var="message" scope="request"/>
	</script>
</c:if>
<script>
	// 이전달 < 버튼
	function previous() {
		var year = "${year}";
		var month = "${month}";

		year = parseInt(year);
		month = parseInt(month);

		if (month === 1) {
			year--;
			month = 12;
		} else {
			month--;
		}

		location.href = "status?year=" + year + "&month=" + month;
	}
	
	//다음달 > 버튼
	function next() {
		var year = "${year}";
		var month = "${month}";

		year = parseInt(year);
		month = parseInt(month);

		if (month === 12) {
			year++;
			month = 1;
		} else {
			month++;
		}

		location.href = "status?year=" + year + "&month=" + month;
	}

	var todayBtn = $("#todayBtn");

	// 오늘 버튼
	todayBtn.on("click", function() {

		// 현재 날짜와 시간을 가져오는 Date 객체 생성
		var today = new Date();

		// 날짜 관련 정보 추출
		var year = today.getFullYear(); // 연도
		var month = today.getMonth() + 1; // 월 (0부터 시작하므로 1을 더해줌)
		$.ajax({
			url : "today",
			type : "get",
			success : function(num, status, xhr) {
				if (xhr.status === 200) {
					console.log('요청이 성공했습니다.', num);
					location.href = "status?year=" + year + "&month=" + month + "&num=" + num;
				} else {
					console.log('요청이 실패했습니다.');
				}
			}
		});
	});
	
	// 새 페이지에서 아코디언을 열도록 설정
	$(document).ready(function() {
	    var num = new URLSearchParams(window.location.search).get('num');
	    if (num) {
	        $("#accordionBtn" + num).click();
	    }
	});
</script>